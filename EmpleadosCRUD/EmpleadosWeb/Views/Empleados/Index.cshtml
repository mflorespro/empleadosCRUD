@{
    ViewData["Title"] = "Lista de Empleados";
}
<div x-data="empleadosApp()" x-init="init()" class="p-4">
    <h2 class="text-2xl font-bold mb-4">Empleados</h2>
    <button @@click="abrirModalCrear()" class="bg-green-600 text-white px-4 py-2 rounded mb-4">Nuevo Empleado</button>
    <div id="listaEmpleados" x-html="listaHtml"></div>
    <div x-show="modalVisible" x-transition class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl p-6">
            <h2 class="text-xl font-semibold mb-4" x-text="modalTitulo"></h2>
            <form x-ref="formEmpleado" @@submit.prevent="guardarEmpleado">
                <div id="formularioEmpleado" x-html="formHtml"></div>
                <div class="mt-4 flex justify-end space-x-2">
                    <button type="button" @@click="cerrarModal()" class="px-4 py-2 bg-gray-300 rounded">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/alpinejs" defer></script>
<script>
function empleadosApp() {
    return {
        modalVisible: false,
        modalTitulo: '',
        formHtml: '',
        listaHtml: '',
        init() {
            this.cargarLista();
        },
        cargarLista() {
            fetch('/Empleados/ListarAjax')
                .then(res => res.text())
                .then(html => this.listaHtml = html);
        },
        abrirModalCrear() {
            fetch('/Empleados/CreatePartial')
                .then(res => res.text())
                .then(html => {
                    this.modalTitulo = 'Nuevo Empleado';
                    this.formHtml = html;
                    this.modalVisible = true;
                });
        },
        guardarEmpleado() {
            const form = this.$refs.formEmpleado;
            fetch(form.action, {
                method: 'POST',
                body: new FormData(form)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    Swal.fire('Guardado', 'Empleado registrado correctamente', 'success');
                    this.modalVisible = false;
                    this.cargarLista();
                } else {
                    Swal.fire('Error', data.message || 'No se pudo guardar el empleado', 'error');
                }
            });
        },
        cerrarModal() {
            this.modalVisible = false;
        }
    }
}
</script>